@model IEnumerable<dev_backend_habitly_eixo2.Models.Habito>

@{
    ViewData["Title"] = "Meus Hábitos";
}

@if (TempData["MensagemSucesso"] != null)
{
    <div id="msgSucesso" class="alert alert-success">
        @TempData["MensagemSucesso"]
    </div>

    <script>
        setTimeout(function () {
            const msg = document.getElementById("msgSucesso");
            if (msg) msg.style.display = "none";
        }, 4000);
    </script>
}

<div class="container py-4">

    <h2 class="fw-bold text-center mb-4">
        Meus Hábitos
    </h2>

    <div class="row g-4 justify-content-center">

        @foreach (var h in Model)
        {
            <div class="col-12 col-md-6 col-lg-4">
                <div class="habit-card">

                    <h5 class="habit-title">@h.TituloHabito</h5>

                    <p class="habit-date">
                        📅 @h.DataInicio.ToShortDateString() → @h.DataFim.ToShortDateString()
                    </p>

                    <span class="status-badge">@h.StatusHabito</span>

                    @if (!string.IsNullOrEmpty(h.TagsCsv))
                    {
                        var tags = h.TagsCsv.Split(';', System.StringSplitOptions.RemoveEmptyEntries).Select(t=>t.Trim()).Where(t=>t.Length>0).ToList();
                        if (tags.Count > 0)
                        {
                            <div style="margin:8px 0; display:flex; gap:8px; flex-wrap:wrap;">
                                @foreach(var t in tags)
                                {
                                    <span style="background:#E8F6F4;color:#0b5d56;padding:4px 8px;border-radius:999px;font-weight:700;font-size:12px;">@t</span>
                                }
                            </div>
                        }
                    }

                    <form asp-controller="Checkins" asp-action="CreateQuick" method="post">
                        <input type="hidden" name="idHabito" value="@h.IdHabito" />
                        <button class="btn btn-checkin w-100">
                            ✅ Fazer Check-in
                        </button>
                    </form>

                    <div class="actions">
                        <a asp-action="Edit" asp-route-id="@h.IdHabito" class="btn-action edit">✏️ Editar</a>
                        <a asp-action="Details" asp-route-id="@h.IdHabito" class="btn-action detail">🔍 Detalhes</a>
                        <a asp-action="Delete" asp-route-id="@h.IdHabito" class="btn-action delete">🗑 Excluir</a>
                        <form asp-action="Arquivar" method="post" style="display:inline-block; margin-left:6px;">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="id" value="@h.IdHabito" />
                            <button type="submit" class="btn-action archive" title="Arquivar">📦 Arquivar</button>
                        </form>
                    </div>
                </div>
            </div>
        }
    </div>

    <div class="text-center mt-4">
        <a asp-action="Calendario" class="btn-secondary-main">📅 Ver Calendário</a>
        <a asp-action="Create" class="btn-primary-main">➕ Novo Hábito</a>
    </div>
</div>

<style>
    body {
        background: #F6F9F6;
    }

    .habit-card {
        background: #ffffffcc;
        border-radius: 16px;
        padding: 20px;
        backdrop-filter: blur(6px);
        box-shadow: 0 6px 14px rgba(0,0,0,0.08);
        border: 1px solid rgba(0,0,0,0.05);
        transition: .25s;
    }

        .habit-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 22px rgba(0,0,0,0.12);
        }

    .habit-title {
        font-weight: 700;
        font-size: 18px;
        margin-bottom: 6px;
        color: #187A2F;
    }

    .habit-date {
        font-size: 14px;
        color: #6C757D;
        margin-bottom: 10px;
    }

    .status-badge {
        background: #E3F6E4;
        color: #187A2F;
        font-weight: 600;
        padding: 4px 10px;
        border-radius: 10px;
        font-size: 13px;
        display: inline-block;
        margin-bottom: 12px;
    }

    .btn-checkin {
        background: #2ECC71;
        border: none;
        color: #fff;
        font-weight: 600;
        padding: 10px;
        margin-bottom: 12px;
        border-radius: 10px;
        transition: .2s;
    }

        .btn-checkin:hover {
            background: #27AE60;
        }

    .actions {
        display: flex;
        justify-content: space-between;
    }

    .btn-action {
        padding: 6px 12px;
        border-radius: 8px;
        color: #fff;
        font-size: 13px;
        font-weight: 600;
        text-decoration: none;
    }

        .btn-action.edit {
            background: #FFB703;
        }

        .btn-action.detail {
            background: #00A8CC;
        }

        .btn-action.archive {
            background: #6C757D;
        }

        .btn-action.delete {
            background: #E63946;
        }

    .btn-primary-main {
        background: #187A2F;
        color: #fff;
        padding: 10px 18px;
        border-radius: 10px;
        font-weight: 600;
        text-decoration: none;
        margin-left: 8px;
    }

    .btn-secondary-main {
        background: #E0EAE0;
        color: #187A2F;
        padding: 10px 18px;
        border-radius: 10px;
        font-weight: 600;
        text-decoration: none;
    }
</style>
